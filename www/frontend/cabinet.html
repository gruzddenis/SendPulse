
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.1.1">
    <title>Offcanvas template Â· Bootstrap</title>



    <!-- Bootstrap core CSS -->
    <link href="https://getbootstrap.com/docs/4.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="https://getbootstrap.com/docs/4.5/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="https://getbootstrap.com/docs/4.5/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="https://getbootstrap.com/docs/4.5/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="manifest" href="https://getbootstrap.com/docs/4.5/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="https://getbootstrap.com/docs/4.5/assets/img/favicons/safari-pinned-tab.svg" color="#563d7c">
    <link rel="icon" href="https://getbootstrap.com/docs/4.5/assets/img/favicons/favicon.ico">
    <meta name="msapplication-config" content="https://getbootstrap.com/docs/4.5/assets/img/favicons/browserconfig.xml">
    <meta name="theme-color" content="#563d7c">


    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>
</head>
<body class="bg-light">


<div class="nav-scroller bg-white shadow-sm">
    <nav class="nav nav-underline">
        <h5 class="nav-link active" >TODO</h5>
        <a href="#login-form" rel="modal:open" class="btn btn-outline-success my-2 my-sm-0">Create new task</a>
    </nav>
</div>

<main role="main" class="container">
    <div class="d-flex align-items-center p-3 my-3 text-white-50 bg-purple rounded shadow-sm">
        <img class="mr-3" src="https://getbootstrap.com/docs/4.5/assets/brand/bootstrap-outline.svg" alt="" width="48" height="48">
        <div class="lh-100">
            <h6 class="mb-0 text-white lh-100">Bootstrap</h6>
            <small>Since 2011</small>
        </div>
    </div>

    <div class="my-3 p-3 bg-white rounded shadow-sm">
        <h6 class="border-bottom border-gray pb-2 mb-0" id="main">Tasks</h6>
        <small class="d-block text-right mt-3">
            <a href="#">All Tasks</a>
        </small>
    </div>

    </div>

    <div class="my-3 p-3 bg-white rounded shadow-sm">
        <h6 class="border-bottom border-gray pb-2 mb-0" id="sub">Sub Tasks</h6>

        <small class="d-block text-right mt-3">
            <a href="#">All Sub Tasks</a>
        </small>
    </div>

    <form id="login-form" class="modal form-add" method="post" action="http://api.pap.local/tasks">
        <div class="col-md-6">
            <label for="exampleFormControlInput" class="col-form-label">Title:</label>
        </div>
        <input class="form-control" id="exampleFormControlInput" rows="3" name="title">
        <div class="col-md-6">
            <label for="exampleFormControlTextarea" class="col-form-label">Text:</label>
        </div>
        <textarea class="form-control" id="exampleFormControlTextarea" name="text" rows="3"></textarea>
        <input class="form-control" id="parent_id" rows="3" name="parent_id" type="hidden" value="">
        <input class="form-control" id="current_id" rows="3" type="hidden" value="">
        <div class="container well form-group">
            <div class="row">
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="date-fr" class="col-form-label">Date:</label>
                    <div class="form-control-wrapper">
                        <input type="text" id="date-fr" class="form-control floating-label" name="finish" value="18/03/2015 08:35:00" placeholder="">
                    </div>
                </div>
            </div>
            <div id="error_new" style="color: red;display:none"></div>
            <button type="submit" class="btn btn-success">Send</button>
        </div>
    </form>

</main>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="https://getbootstrap.com/docs/4.5/assets/js/vendor/jquery.slim.min.js"><\/script>')</script><script src="https://getbootstrap.com/docs/4.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
<script rel="stylesheet" src="moment.min.js" ></script>
<script rel="stylesheet" src="bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js" ></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="https://getbootstrap.com/docs/4.5/assets/js/vendor/jquery.slim.min.js"><\/script>')</script><script src="https://getbootstrap.com/docs/4.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
<link rel="stylesheet" href="bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css" />
<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/js/ripples.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/js/material.min.js"></script>
<script type="text/javascript" src="http://momentjs.com/downloads/moment-with-locales.min.js"></script>
<script type="text/javascript" src="bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

<script>
    $(document).on('click','.add', function(event) {
        $('#parent_id').attr('name', 'parent_id');
        $('#parent_id').val($(this).attr('data-id'));
        $('#exampleFormControlInput').val('');
        $('#exampleFormControlTextarea').val('');
        $('#login-form').removeClass('form-edit').addClass('form-add');
    });

    $(document).on('click','.btn-outline-success', function(event) {
        $('#parent_id').removeAttr('name');
        $('#exampleFormControlInput').val('');
        $('#exampleFormControlTextarea').val('');
        $('#login-form').removeClass('form-edit').addClass('form-add');
    });

    $(document).on('click','.edit', function(event) {
        $('#parent_id').val($(this).attr('data-parent-id'));
        $('#date-fr').val(moment($(this).attr('data-finish')).format('YYYY/MM/DD HH:mm:ss'));
        $('#exampleFormControlInput').val($(this).attr('data-title'));
        $('#exampleFormControlTextarea').val($(this).attr('data-text'));
        $('#login-form').removeClass('form-add').addClass('form-edit');
        $('#current_id').val($(this).attr('data-id'));
    });

    $(document).on('click', '#delete', function(event) {
        event.preventDefault();
        $.ajax({
            url: 'http://api.pap.local/tasks/' + $(this).attr('data-id'),
            method: 'DELETE',
            headers: {
                "Auth-Token": localStorage.getItem('api_token')
            },
            contentType: "application/x-www-form-urlencoded",
            data: $(this).serialize(),
            success: function(result) {
                document.location.href = '';
            },
            error: function(request,msg,error) {
                if (error == 'Unauthorized') {
                    document.location.href = 'login.html';
                }
            }
        });
    });

    $(document).on('click', '#close', function(event) {
        event.preventDefault();
        $.ajax({
            url: 'http://api.pap.local/tasks/' + $(this).attr('data-id'),
            method: 'PATCH',
            headers: {
                "Auth-Token": localStorage.getItem('api_token')
            },
            contentType: "application/x-www-form-urlencoded",
            data: $(this).serialize(),
            success: function(result) {
                document.location.href = '';
            },
            error: function(request,msg,error) {
                if (error == 'Unauthorized') {
                    document.location.href = 'login.html';
                }
            }
        });
    });

    $(document).on('submit', '.form-add', function(event) {
         event.preventDefault();
        $.ajax({
            url: 'http://api.pap.local/tasks',
            method: 'POST',
            headers: {
                "Auth-Token": localStorage.getItem('api_token')
            },
            contentType: "application/x-www-form-urlencoded",
            data: $(this).serialize(),
            success: function(result) {
                document.location.href = '';
            },
            error: function(request,msg,error) {
                if (error == 'Unauthorized') {
                    document.location.href = 'login.html';
                } else {
                    $('#error_new').show();
                    $('#error_new').text(request.responseText);
                }
            }
        });
    });

    $(document).on('submit', '.form-edit', function(event) {
        event.preventDefault();
        $.ajax({
            url: 'http://api.pap.local/tasks/' + $('#current_id').val(),
            method: 'PUT',
            headers: {
                "Auth-Token": localStorage.getItem('api_token')
            },
            contentType: "application/x-www-form-urlencoded",
            data: $(this).serialize(),
            success: function(result) {
                document.location.href = '';
            },
            error: function(request,msg,error) {
                if (error == 'Unauthorized') {
                    document.location.href = 'login.html';
                } else {
                    $('#error_new').show();
                    $('#error_new').text(request.responseText);
                }
            }
        });
    });

    $.ajax({
        url: 'http://api.pap.local/tasks',
        method: 'GET',
        headers: {
            "Auth-Token": localStorage.getItem('api_token')
        },
        contentType: 'application/json',
        success: function(result) {
            let tasks = result;
            for (i=0;i<tasks.length;i++) {
                $("#main").after(`<div class="media text-muted pt-3 showSub" data-att="${i}">
            <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#6f42c1"/><text x="50%" y="50%" fill="#6f42c1" dy=".3em">32x32</text></svg>
            <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                    <strong class="text-gray-dark">${tasks[i].finish}</strong>
                    <div>
                        <a href="#login-form" class="add" rel="modal:open" id="${'add'+tasks[i].id}" data-id="${tasks[i].id}">add</a>
                        <a href="#login-form" rel="modal:open" class="edit" data-title="${tasks[i].title}" data-parent-id="${tasks[i].parent_id}" data-text="${tasks[i].text}" data-finish="${tasks[i].finish}" data-id="${tasks[i].id}">edit</a>
                        <a href="#" id="close" data-id="${tasks[i].id}"><i class="gj-icon">close</i></a>
                        <a href="#" id="delete" data-id="${tasks[i].id}"><i class="gj-icon">delete</i></a>
                    </div>
                </div>
                <span class="d-block">${tasks[i].title}</span>
                 ${tasks[i].text}
            </div>
        </div>`);
            }

            $('.showSub').on('click', function(event) {
                $(".subTask").remove();
                let attr = $(this).attr('data-att');
                let subTask = tasks[attr]['sub_tasks'];
                for (i=0;i<subTask.length;i++) {
                    $('#sub').after(`<div class="media text-muted pt-3 subTask">
            <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"/><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
            <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                    <strong class="text-gray-dark">${subTask[i].finish}</strong>
                    <div>
                        <a href="#login-form" rel="modal:open" class="edit" data-title="${subTask[i].title}" data-parent-id="${subTask[i].parent_id}" data-text="${subTask[i].text}" data-finish="${subTask[i].finish}" data-id="${subTask[i].id}><i class="gj-icon">edit</i></a>
                        <a href="#" id="close" data-id="${subTask[i].id}"><i class="gj-icon">close</i></a>
                        <a href="#" id="delete" data-id="${subTask[i].id}"><i class="gj-icon">delete</i></a>
                    </div>
                </div>
                <span class="d-block">${subTask[i].title}</span>
                ${subTask[i].text}
            </div>
        </div>`);
                }
            });
        },
        error: function(request,msg,error) {
            if (error == 'Unauthorized') {
                document.location.href = 'login.html';
            }
        }
    });

    $(document).ready(function()
    {
        $('#date').bootstrapMaterialDatePicker
        ({
            time: false,
            clearButton: true
        });

        $('#time').bootstrapMaterialDatePicker
        ({
            date: false,
            shortTime: false,
            format: 'HH:mm'
        });

        $('#date-format').bootstrapMaterialDatePicker
        ({
            format: 'dddd DD MMMM YYYY - HH:mm'
        });
        $('#date-fr').bootstrapMaterialDatePicker
        ({
            format: 'YYYY/MM/DD HH:mm:ss',
            lang: 'ru',
            weekStart: 1,
            cancelText : 'ANNULER',
            nowButton : true,
            switchOnClick : true
        });

        $('#date-end').bootstrapMaterialDatePicker
        ({
            weekStart: 0, format: 'DD/MM/YYYY HH:mm'
        });
        $('#date-start').bootstrapMaterialDatePicker
        ({
            weekStart: 0, format: 'DD/MM/YYYY HH:mm', shortTime : true
        }).on('change', function(e, date)
        {
            $('#date-end').bootstrapMaterialDatePicker('setMinDate', date);
        });

        $('#min-date').bootstrapMaterialDatePicker({ format : 'DD/MM/YYYY HH:mm', minDate : new Date() });

        $.material.init()
    });
</script>

</body>
</html>
